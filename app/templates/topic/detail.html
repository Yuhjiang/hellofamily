{% extends 'base.html' %}

{% block title %} {{ topic.title }} {% endblock %}

{% block styles %}
{{ super() }}
<link href="//cdn.bootcss.com/prism/1.8.0/themes/prism.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/mditor@1.0.5/dist/css/mditor.min.css" />
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-9 panel">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    {{ topic.title }}
                </div>
                <div class="card-body">
                    <div class="markdown-text">
                        {{ topic.body }}
                    </div>
                </div>
            </div>
            <div class="card">
                <ul class="list-group list-group-flush">
                    {% for comment in comments %}
                        <li class="list-group-item">
                            <div class="user-info">{{ comment.comment_author.username }}</div>
                            <div class="markdown-text">{{ comment.body }}</div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="card">
                <form action="{{ url_for('topic.comment_add') }}" method="post">
                    {{ form.csrf_token() }}
                    <input type="hidden" name="topic_id" value="{{ topic.id }}">
                    <textarea name="body" id="editor">

                    </textarea>
                    <button class="btn btn-primary float-right">评论</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.zhimg.com/mditor@1.0.5/dist/js/mditor.min.js"></script>
<script src="https://cdn.bootcss.com/marked/0.3.19/marked.min.js"></script>
<script src="https://cdn.bootcss.com/prism/1.13.0/prism.js"></script>
<script src="https://cdn.bootcss.com/prism/1.13.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
    var e = function (sel) {
        return document.querySelector(sel)
    }

    var es = function (sel) {
        return document.querySelectorAll(sel)
    }

    var markContents = function () {
        var contentDivs = es('.markdown-text')
        for (var i = 0; i < contentDivs.length; i++) {
            var contentDiv = contentDivs[i]
            var content = marked(contentDiv.textContent)
            contentDiv.innerHTML = content
        }
    }

    var highlight = function () {
         Prism.plugins.autoloader.languages_path = 'https://cdn.bootcss.com/prism/1.13.0/components/'
    }

    var __main = function () {
        markContents()
        highlight()
    }
    __main()
</script>
<script>
    var mditor =  Mditor.fromTextarea(document.getElementById('editor'))
    mditor.split = false
</script>
{% endblock %}